#include <QTextStream>
#include <QMessageBox>
#include <QDir>
#include <QDateTime>
#include "mainwindow.h"
#include "ui_mainwindow.h"
#include "treeDrawing.h"

MainWindow::MainWindow(QWidget *parent)
    : QMainWindow(parent)
    , ui(new Ui::MainWindow)
{
    ui->setupUi(this);
    loadWindow = new LoadWindow;
    file = new QFile("./saves/genoms.csv");
    pixmap = new QPixmap;


    StandardDeviations stddevs;
    stddevs.plannedRotate = 0; //7.5
    stddevs.unplannedRotate = 0; //1
    stddevs.trunkLength = 0; //0.25
    stddevs.antennaRotate = 0; //0.1

    uint8_t ptr[Genom::m_size] = {155, 187, 20, 5, 5, 136, 168, 255, 236, 28, 252, 114, 31, 141, 80, 88, 248, 58, 81, 247, 32, 97, 253, 47, 172, 106, 13, 70, 135, 238, 42, 199, 123, 233, 45, 176, 81, 255, 188, 129, 216, 179, 209, 45, 19, 40, 247, 216, 25, 68, 130, 243, 32, 51, 89, 165, 239, 247, 42, 124, 0, 154, 240, 62, 18, 48, 15, 103, 209, 249, 142, 78, 185, 121, 84, 162, 8, 18, 14, 75, 87, 244, 50, 194, 121, 146, 62, 217, 38, 134, 223, 122, 58, 229, 121, 60, 249, 22, 8, 133, 208, 211, 46, 99, 130, 27, 245, 177, 74, 62, 245, 217, 43, 18, 56, 219, 106, 149, 11, 56, 117, 170, 37, 125, 179, 246, 55, 211, 55, 93, 239, 134, 61, 111, 35, 62, 73, 77, 43, 111, 110, 118, 252, 55, 13, 161, 42, 75, 80, 204, 75, 160, 200, 200, 13, 161, 237, 150, 111, 77, 114, 186, 238, 34, 40, 218, 76, 237, 132, 173, 137, 112, 219, 163, 196, 25, 96, 37, 65, 81, 51, 21, 253, 30, 118, 247, 163, 16, 207, 183, 54, 122, 219, 159, 216, 98};
    uint8_t ptr2[Genom::m_size] = {155, 187, 20, 6, 224, 136, 210, 148, 36, 68, 244, 114, 224, 141, 102, 175, 248, 58, 81, 122, 32, 129, 110, 253, 172, 68, 247, 70, 240, 15, 89, 199, 123, 233, 123, 176, 81, 56, 181, 129, 200, 179, 253, 132, 19, 201, 112, 216, 25, 181, 130, 243, 32, 51, 98, 32, 170, 247, 150, 124, 79, 131, 240, 62, 212, 48, 15, 175, 144, 249, 142, 78, 233, 94, 170, 148, 194, 18, 134, 14, 87, 244, 249, 194, 121, 146, 236, 217, 32, 134, 147, 122, 58, 229, 32, 215, 100, 57, 77, 133, 208, 211, 46, 99, 18, 102, 60, 192, 74, 52, 84, 12, 138, 70, 150, 219, 106, 149, 199, 211, 117, 138, 16, 125, 193, 246, 55, 211, 124, 38, 239, 134, 96, 67, 35, 62, 73, 179, 43, 111, 103, 68, 252, 55, 13, 67, 42, 168, 80, 203, 75, 160, 179, 200, 196, 22, 237, 150, 111, 160, 114, 186, 111, 34, 40, 119, 11, 237, 71, 180, 137, 112, 219, 163, 196, 25, 63, 46, 65, 81, 51, 188, 253, 246, 118, 118, 163, 132, 207, 247, 54, 122, 118, 90, 97, 98};
    uint8_t ptr3[Genom::m_size] = {156, 242, 183, 127, 152, 77, 156, 60, 63, 241, 40, 15, 195, 204, 9, 11, 108, 178, 17, 157, 201, 166, 219, 225, 96, 250, 120, 102, 37, 106, 229, 115, 192, 118, 255, 103, 249, 23, 225, 127, 89, 22, 87, 73, 220, 53, 178, 168, 203, 155, 17, 99, 213, 222, 35, 10, 52, 122, 49, 192, 220, 69, 243, 227, 246, 35, 72, 196, 1, 0, 113, 27, 8, 182, 82, 48, 110, 93, 166, 119, 145, 220, 159, 122, 12, 222, 253, 173, 222, 213, 231, 245, 75, 199, 50, 106, 83, 19, 163, 41, 129, 85, 218, 106, 39, 100, 10, 168, 70, 205, 33, 220, 130, 134, 40, 11, 19, 31, 61, 57, 46, 121, 178, 120, 44, 98, 45, 163, 155, 220, 93, 196, 254, 245, 165, 235, 140, 19, 223, 177, 91, 124, 83, 109, 249, 172, 22, 85, 209, 148, 60, 67, 150, 240, 110, 180, 152, 64, 134, 225, 82, 235, 196, 171, 184, 108, 76, 123, 157, 152, 73, 207, 44, 13, 29, 214, 252, 18, 74, 158, 111, 195, 46, 105, 81, 134, 34, 210, 237, 127, 250, 208, 91, 71, 152, 128};
    uint8_t ptr4[Genom::m_size] = {225, 228, 249, 43, 197, 71, 36, 214, 27, 139, 10, 88, 214, 180, 240, 51, 73, 121, 136, 142, 209, 210, 217, 70, 154, 247, 158, 207, 201, 69, 85, 0, 249, 188, 3, 74, 158, 176, 73, 199, 49, 141, 125, 234, 126, 28, 167, 182, 88, 10, 44, 222, 7, 211, 206, 125, 101, 230, 175, 232, 155, 29, 75, 187, 161, 229, 10, 172, 136, 70, 108, 245, 12, 229, 70, 229, 119, 177, 21, 138, 178, 201, 234, 163, 20, 140, 202, 33, 193, 13, 76, 187, 188, 92, 114, 237, 217, 74, 116, 75, 82, 186, 155, 218, 38, 220, 105, 183, 100, 77, 253, 73, 151, 175, 67, 74, 27, 152, 222, 144, 179, 7, 141, 205, 245, 213, 139, 66, 6, 159, 210, 73, 183, 117, 155, 49, 201, 206, 235, 35, 154, 127, 30, 203, 154, 253, 185, 227, 162, 205, 228, 114, 104, 19, 1, 230, 78, 129, 27, 177, 122, 184, 253, 79, 255, 206, 89, 210, 37, 196, 255, 28, 156, 3, 41, 107, 13, 159, 160, 50, 113, 19, 157, 200, 181, 28, 221, 183, 103, 56, 19, 140, 237, 49, 161, 221};
    uint8_t ptr5[Genom::m_size] = {225, 228, 249, 43, 197, 77, 36, 214, 63, 241, 40, 15, 214, 180, 240, 51, 108, 178, 17, 142, 201, 166, 217, 225, 96, 250, 158, 207, 37, 106, 85, 115, 94, 188, 3, 103, 249, 176, 225, 199, 89, 22, 87, 234, 220, 53, 167, 182, 88, 10, 44, 99, 213, 222, 35, 125, 52, 122, 49, 232, 155, 29, 243, 187, 246, 229, 72, 172, 1, 70, 113, 27, 12, 229, 70, 48, 119, 93, 166, 119, 178, 201, 159, 122, 12, 140, 202, 33, 222, 213, 76, 245, 188, 92, 114, 106, 217, 19, 163, 41, 82, 186, 218, 106, 39, 220, 105, 183, 70, 77, 253, 220, 151, 134, 67, 74, 27, 31, 222, 57, 46, 121, 178, 120, 44, 98, 139, 66, 155, 220, 93, 73, 254, 117, 165, 49, 201, 19, 223, 35, 154, 124, 83, 109, 154, 172, 185, 85, 209, 205, 60, 114, 104, 19, 110, 230, 78, 129, 27, 225, 82, 184, 253, 90, 255, 206, 89, 123, 37, 152, 71, 207, 44, 160, 255, 214, 13, 18, 74, 50, 113, 19, 46, 200, 81, 134, 34, 183, 103, 127, 19, 140, 91, 49, 152, 221};
    uint8_t ptr6[Genom::m_size] = {158, 196, 221, 146, 243, 206, 232, 120, 61, 157, 209, 164, 240, 204, 54, 223, 167, 63, 223, 159, 42, 95, 83, 130, 100, 175, 37, 85, 80, 65, 18, 51, 127, 168, 209, 82, 103, 192, 136, 56, 3, 97, 246, 62, 161, 191, 25, 53, 75, 241, 52, 79, 139, 86, 26, 246, 80, 173, 157, 193, 200, 152, 165, 237, 26, 104, 102, 184, 81, 98, 87, 4, 134, 240, 4, 9, 131, 16, 208, 216, 231, 71, 14, 121, 171, 98, 48, 117, 106, 26, 67, 162, 198, 184, 9, 56, 233, 217, 230, 129, 133, 246, 150, 143, 253, 132, 157, 55, 108, 193, 207, 214, 157, 238, 64, 121, 144, 170, 29, 165, 199, 170, 155, 242, 254, 129, 0, 240, 15, 13, 244, 9, 156, 76, 158, 83, 89, 227, 110, 27, 125, 44, 36, 68, 180, 209, 112, 210, 132, 254, 236, 188, 142, 104, 127, 251, 229, 18, 80, 214, 250, 218, 3, 133, 188, 25, 222, 133, 244, 144, 209, 74, 228, 180, 60, 214, 16, 172, 88, 139, 118, 31, 1, 212, 45, 108, 195, 177, 54, 139, 104, 185, 253, 134, 223, 3};
    uint8_t ptr7[Genom::m_size] = {7, 119, 113, 9, 174, 44, 107, 26, 177, 193, 134, 165, 220, 128, 145, 81, 254, 124, 103, 121, 177, 34, 179, 6, 40, 27, 165, 246, 248, 116, 227, 248, 227, 99, 106, 83, 179, 210, 195, 44, 162, 171, 191, 25, 53, 226, 215, 61, 54, 134, 127, 142, 249, 3, 104, 158, 165, 234, 206, 195, 43, 185, 38, 136, 98, 27, 60, 118, 90, 44, 147, 20, 243, 17, 190, 89, 21, 108, 47, 135, 110, 67, 245, 182, 33, 174, 60, 87, 169, 46, 191, 42, 237, 201, 227, 172, 237, 31, 237, 164, 107, 215, 192, 162, 158, 86, 178, 21, 30, 50, 97, 218, 210, 132, 178, 179, 10, 9, 73, 221, 125, 212, 48, 94, 168, 135, 58, 115, 34, 95, 205, 144, 85, 168, 117, 232, 17, 197, 74, 238, 218, 232, 113, 159, 123, 149, 234, 117, 106, 220, 69, 2, 63, 18, 8, 169, 57, 80, 82, 88, 189, 223, 234, 79, 255, 164, 255, 255, 79, 255, 164, 6, 130, 93, 223, 152, 127, 219, 223, 165, 98, 136, 246, 162, 9, 221, 58, 146, 90, 52, 151, 164, 208, 243, 107, 150};
    uint8_t ptr8[Genom::m_size] = {1, 226, 133, 145, 160, 246, 149, 48, 188, 132, 116, 4, 246, 156, 245, 164, 181, 136, 75, 228, 29, 184, 11, 29, 64, 93, 217, 107, 6, 150, 73, 12, 22, 72, 7, 205, 220, 223, 203, 205, 165, 68, 224, 235, 35, 38, 52, 179, 73, 200, 0, 180, 197, 130, 154, 187, 118, 80, 6, 37, 32, 137, 173, 205, 165, 231, 247, 87, 144, 89, 35, 43, 248, 241, 197, 93, 154, 223, 206, 140, 181, 15, 52, 81, 177, 201, 67, 22, 117, 106, 146, 27, 103, 171, 40, 86, 159, 148, 109, 182, 43, 3, 241, 59, 139, 185, 140, 88, 172, 174, 20, 3, 125, 44, 51, 83, 249, 13, 150, 169, 55, 40, 254, 27, 131, 242, 240, 157, 99, 52, 51, 210, 229, 197, 64, 69, 189, 82, 82, 105, 227, 66, 114, 245, 20, 228, 148, 88, 148, 188, 48, 186, 180, 206, 72, 66, 191, 205, 86, 99, 196, 68, 201, 122, 248, 93, 221, 46, 180, 223, 102, 51, 222, 0, 252, 249, 205, 172, 107, 249, 90, 123, 188, 27, 102, 82, 238, 119, 25, 173, 30, 117, 130, 153, 106, 187};
    uint8_t ptr9[Genom::m_size] = {144, 191, 205, 43, 197, 71, 36, 166, 27, 51, 10, 88, 54, 180, 105, 51, 50, 51, 136, 142, 209, 210, 28, 70, 154, 219, 105, 207, 156, 253, 85, 110, 170, 224, 3, 179, 232, 176, 73, 216, 109, 251, 125, 165, 126, 28, 45, 182, 31, 180, 90, 222, 7, 141, 206, 220, 101, 230, 175, 232, 52, 29, 75, 114, 161, 229, 131, 220, 136, 99, 108, 18, 172, 229, 58, 116, 38, 177, 218, 21, 178, 157, 60, 163, 20, 33, 202, 35, 232, 13, 191, 213, 188, 92, 133, 50, 243, 244, 116, 75, 82, 24, 225, 126, 38, 35, 105, 212, 64, 43, 212, 73, 151, 175, 67, 74, 52, 152, 34, 144, 179, 151, 141, 82, 238, 213, 139, 106, 6, 159, 102, 61, 219, 237, 80, 59, 201, 206, 235, 35, 154, 127, 30, 173, 174, 253, 185, 83, 134, 205, 95, 117, 104, 252, 149, 187, 38, 129, 27, 177, 122, 184, 253, 79, 202, 206, 250, 210, 89, 205, 255, 88, 156, 33, 41, 107, 134, 159, 143, 50, 113, 52, 157, 200, 80, 27, 21, 171, 103, 56, 19, 158, 198, 167, 161, 54};
    uint8_t ptr10[Genom::m_size] = {225, 191, 249, 43, 197, 71, 36, 166, 27, 241, 10, 88, 214, 180, 105, 51, 108, 51, 17, 142, 201, 210, 217, 225, 96, 219, 105, 207, 156, 253, 85, 110, 94, 188, 3, 179, 232, 176, 225, 216, 109, 251, 125, 165, 220, 53, 45, 182, 88, 10, 44, 99, 213, 141, 35, 220, 52, 230, 49, 232, 155, 29, 243, 187, 246, 229, 131, 172, 136, 70, 108, 27, 172, 229, 58, 116, 38, 177, 166, 119, 178, 157, 60, 163, 20, 33, 202, 35, 222, 13, 76, 245, 188, 92, 133, 50, 217, 19, 163, 41, 82, 186, 218, 126, 39, 220, 105, 183, 64, 77, 212, 220, 151, 134, 67, 74, 163, 31, 34, 144, 46, 121, 178, 82, 44, 213, 139, 66, 6, 159, 93, 61, 219, 237, 165, 59, 201, 19, 223, 35, 154, 127, 30, 109, 174, 253, 185, 85, 209, 205, 95, 117, 104, 252, 110, 230, 78, 129, 27, 177, 82, 184, 253, 79, 255, 206, 250, 123, 89, 152, 255, 207, 44, 33, 41, 107, 134, 159, 143, 50, 113, 19, 46, 200, 80, 134, 34, 183, 103, 127, 19, 158, 91, 167, 152, 54};
    uint8_t ptr11[Genom::m_size] = {252, 152, 170, 43, 197, 1, 177, 60, 63, 241, 171, 88, 214, 241, 105, 202, 251, 195, 73, 142, 100, 185, 219, 225, 106, 219, 120, 207, 9, 253, 229, 115, 192, 159, 170, 176, 232, 176, 225, 72, 109, 22, 125, 247, 220, 53, 67, 182, 88, 155, 51, 99, 213, 97, 239, 153, 52, 122, 36, 142, 220, 160, 243, 4, 246, 10, 232, 164, 140, 248, 247, 118, 172, 31, 58, 210, 161, 93, 166, 4, 178, 220, 201, 163, 146, 133, 178, 178, 222, 163, 231, 211, 75, 109, 133, 10, 83, 19, 126, 253, 181, 7, 218, 117, 39, 100, 37, 168, 70, 104, 223, 220, 232, 237, 40, 11, 144, 31, 34, 57, 46, 121, 14, 120, 44, 98, 29, 17, 88, 30, 93, 61, 21, 237, 165, 196, 140, 152, 172, 137, 154, 127, 30, 109, 249, 182, 103, 211, 64, 160, 60, 117, 150, 252, 125, 230, 78, 234, 188, 177, 121, 53, 120, 171, 226, 108, 76, 123, 89, 192, 73, 207, 44, 94, 29, 214, 134, 159, 74, 39, 41, 109, 176, 105, 80, 6, 158, 211, 237, 127, 178, 203, 223, 165, 227, 54};
    uint8_t ptr12[Genom::m_size] = {240, 228, 87, 88, 7, 26, 202, 226, 39, 153, 105, 114, 131, 179, 138, 252, 139, 94, 113, 64, 134, 252, 29, 230, 157, 64, 137, 120, 158, 126, 80, 193, 63, 227, 132, 239, 16, 253, 22, 57, 70, 16, 214, 131, 216, 235, 168, 55, 100, 69, 13, 151, 26, 10, 117, 187, 176, 83, 178, 126, 184, 166, 36, 37, 62, 241, 168, 71, 94, 18, 129, 174, 26, 99, 160, 200, 77, 193, 104, 234, 159, 155, 182, 115, 96, 37, 118, 71, 61, 184, 17, 209, 213, 27, 231, 168, 215, 4, 15, 243, 39, 147, 176, 226, 144, 164, 20, 2, 82, 55, 136, 110, 29, 145, 70, 33, 89, 61, 1, 29, 212, 209, 84, 223, 214, 54, 248, 213, 174, 145, 41, 166, 215, 247, 155, 251, 252, 174, 15, 112, 152, 82, 93, 233, 42, 65, 127, 224, 12, 102, 226, 8, 207, 224, 164, 173, 169, 92, 203, 166, 92, 210, 166, 173, 124, 252, 195, 165, 74, 144, 73, 196, 10, 241, 104, 254, 229, 45, 130, 76, 222, 67, 238, 75, 228, 17, 165, 158, 163, 117, 214, 110, 74, 29, 234, 138};
    uint8_t ptr13[Genom::m_size] = {189, 87, 47, 206, 63, 135, 223, 227, 130, 214, 161, 139, 241, 190, 85, 99, 181, 47, 40, 193, 64, 92, 161, 194, 106, 120, 41, 102, 93, 96, 144, 81, 39, 146, 208, 238, 178, 0, 207, 39, 20, 38, 192, 114, 200, 142, 80, 56, 153, 233, 228, 127, 159, 194, 6, 191, 177, 30, 166, 58, 198, 81, 158, 160, 12, 181, 122, 184, 150, 13, 46, 45, 204, 189, 173, 52, 217, 46, 1, 247, 96, 46, 39, 232, 212, 111, 138, 216, 241, 168, 45, 137, 73, 240, 46, 72, 159, 25, 212, 118, 31, 208, 11, 0, 251, 254, 25, 156, 132, 164, 11, 96, 160, 57, 122, 98, 169, 134, 111, 239, 162, 4, 95, 161, 8, 82, 130, 94, 25, 253, 220, 135, 80, 241, 79, 41, 173, 183, 38, 144, 215, 114, 121, 196, 144, 221, 129, 148, 120, 166, 177, 209, 20, 50, 102, 51, 173, 63, 125, 80, 86, 233, 128, 7, 202, 99, 56, 80, 213, 244, 113, 103, 252, 13, 1, 143, 224, 250, 17, 209, 130, 98, 28, 201, 253, 52, 189, 12, 82, 112, 204, 97, 91, 85, 53, 52};
    uint8_t ptr14[Genom::m_size] = {111, 29, 134, 91, 7, 26, 202, 155, 39, 153, 120, 179, 66, 179, 108, 62, 244, 94, 204, 64, 147, 252, 29, 214, 157, 169, 137, 47, 158, 126, 126, 239, 63, 227, 132, 141, 16, 253, 22, 57, 63, 16, 214, 41, 204, 201, 35, 55, 29, 69, 236, 151, 133, 198, 117, 208, 176, 83, 178, 25, 37, 166, 41, 72, 62, 241, 248, 251, 208, 18, 129, 174, 26, 99, 160, 141, 168, 4, 108, 25, 159, 155, 182, 37, 96, 83, 118, 175, 61, 184, 17, 209, 103, 27, 235, 57, 215, 4, 141, 243, 28, 230, 216, 247, 144, 164, 137, 2, 82, 123, 136, 33, 29, 176, 127, 200, 89, 6, 83, 9, 60, 209, 84, 223, 165, 54, 248, 213, 174, 101, 64, 166, 215, 229, 249, 251, 191, 9, 15, 57, 152, 4, 84, 233, 121, 0, 161, 224, 135, 102, 147, 8, 207, 224, 164, 52, 46, 92, 227, 166, 92, 5, 7, 231, 124, 252, 195, 165, 75, 97, 25, 118, 10, 241, 104, 254, 190, 45, 140, 64, 207, 167, 212, 152, 228, 17, 165, 158, 163, 56, 2, 217, 74, 29, 234, 138};
    uint8_t ptr15[Genom::m_size] = {7, 119, 87, 9, 174, 44, 202, 26, 177, 193, 105, 114, 220, 179, 138, 252, 254, 94, 103, 64, 134, 252, 29, 6, 40, 64, 137, 246, 248, 116, 227, 248, 63, 99, 132, 83, 179, 210, 195, 44, 70, 16, 191, 131, 216, 235, 215, 61, 100, 134, 13, 142, 249, 10, 117, 158, 165, 83, 178, 195, 43, 166, 38, 37, 98, 27, 168, 71, 90, 44, 129, 20, 26, 17, 160, 200, 21, 108, 104, 234, 159, 155, 245, 182, 33, 37, 118, 87, 61, 46, 17, 209, 237, 27, 231, 172, 237, 31, 15, 164, 39, 147, 176, 162, 144, 86, 178, 125, 30, 50, 136, 110, 29, 145, 178, 179, 10, 61, 1, 29, 125, 212, 84, 223, 168, 54, 58, 213, 34, 95, 41, 166, 215, 168, 117, 251, 252, 174, 74, 238, 152, 232, 113, 233, 123, 149, 127, 224, 106, 102, 69, 8, 207, 224, 8, 173, 169, 80, 203, 88, 92, 210, 234, 173, 255, 164, 255, 165, 79, 255, 73, 196, 130, 241, 104, 254, 229, 45, 130, 76, 98, 136, 238, 162, 9, 17, 58, 146, 90, 52, 214, 110, 74, 243, 107, 150};

    Genom genom2(ptr);
    genom = new Genom(ptr6);
    //genom.cross(genom2, genom);




    genom->genom(ptr);
    QDebug deb = qDebug();
    for (int i = 0; i < Genom::m_size; ++i)
        deb.nospace() << static_cast<int>(ptr[i]) << ", ";

    drawTree(*pixmap, *genom, stddevs);
    ui->label->setPixmap(pixmap->scaled(550, 550, Qt::IgnoreAspectRatio, Qt::SmoothTransformation));
}

MainWindow::~MainWindow()
{
    delete ui;
    delete loadWindow;
    delete file;
    delete pixmap;
    delete genom;
}

void MainWindow::on_randomTreeButton_clicked()
{
    StandardDeviations stddevs;
    stddevs.plannedRotate = 0; //7.5
    stddevs.unplannedRotate = 0; //1
    stddevs.trunkLength = 0; //0.25
    stddevs.antennaRotate = 0; //0.1


    delete genom;
    genom = new Genom;
    uint8_t bytes[Genom::m_size];
    genom->genom(bytes);
    QDebug deb = qDebug();
    for (int i = 0; i < Genom::m_size; ++i)
        deb.nospace() << static_cast<int>(bytes[i]) << ", ";

    drawTree(*pixmap, *genom, stddevs);
    ui->label->setPixmap(pixmap->scaled(550, 550, Qt::IgnoreAspectRatio, Qt::SmoothTransformation));
}

void MainWindow::on_loadButton_clicked()
{
    loadWindow->exec();
}



void MainWindow::on_load_triggered()
{
    loadWindow->exec();
}


void MainWindow::on_save_triggered()
{
    if (!QDir("saves").exists())
        QDir().mkdir("saves");

    if (!file->open(QIODeviceBase::Text | QIODeviceBase::WriteOnly | QIODeviceBase::Append))
    {
        QMessageBox::critical(this, "Ошибка!", "Не удалось создать и/или открыть файл!");
    }
    else
    {
        QTextStream out(file);
        QString dateTime = QDateTime::currentDateTime().toString("dd.MM.yyyy hh:mm:ss");
        out << dateTime;
        uint8_t bytes[Genom::m_size];
        genom->genom(bytes);
        for (int i = 0; i < Genom::m_size; ++i)
            out << ',' << static_cast<int>(bytes[i]);
        out << '\n';
        file->close();

        QString pixmapName = "./saves/TREE_";
        for (int i = 0; i < dateTime.size(); ++i)
        {
            if (dateTime[i] == '.' || dateTime[i] == ':')
                pixmapName.append('_');
            else
                pixmapName.append(dateTime[i]);
        }
        pixmapName += ".png";

        QPixmap preview = pixmap->scaled(100, 100, Qt::IgnoreAspectRatio, Qt::SmoothTransformation);
        if(!preview.save(pixmapName))
        {
            QMessageBox::critical(this, "Ошибка!", "Не удалось сохранить превью дерева!");
        }
    }
}
